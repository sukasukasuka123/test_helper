# 实验室面试追溯工具

## 项目简介

这是一个基于 PySide6 开发的桌面应用程序，用于实验室面试过程的标准化管理和记录追溯。系统支持题库导入、面试者信息管理、随机抽题、评分记录等功能，所有数据存储在本地 SQLite 数据库中。

## 技术栈

- **UI 框架**: PySide6 (Qt for Python)
- **数据库**: SQLite3
- **文件解析**: openpyxl (Excel), csv (CSV)
- **Python 版本**: 3.11+

## 项目结构

```
.
├── main.py                      # 程序入口
├── interview.db                 # SQLite 数据库文件
├── UI/                          # 用户界面模块
│   ├── base_panel.py           # 基础面板组件
│   ├── import_panel.py         # 题库导入面板
│   ├── interviewee_panel.py    # 面试者信息面板
│   ├── question_select_panel.py # 题库选择面板
│   ├── question_runner_panel.py # 抽题与答题面板
│   ├── question_widget.py      # 题目显示组件
│   ├── stats_panel.py          # 记录保存面板
│   └── session_controller.py   # 会话状态控制器
└── service/                     # 业务逻辑模块
    ├── db.py                    # 数据库管理（单例模式）
    ├── schema.py                # 数据库表结构初始化
    ├── importer.py              # 题库导入服务
    ├── interviewee.py           # 面试者管理服务
    ├── meta.py                  # 题库元数据管理
    ├── selector.py              # 题目选择器（随机抽题）
    └── stats.py                 # 面试记录统计服务
```

## 数据库设计

### 1. interviewee（面试者表）
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER PRIMARY KEY | 自增主键 |
| name | TEXT | 姓名 |
| email | TEXT | 邮箱 |
| phone | TEXT | 电话 |
| raw_info | TEXT | 原始信息 JSON |
| info_hash | TEXT | 信息哈希值（用于去重） |
| created_at | TEXT | 创建时间 |

### 2. question_bank（题库表）
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER PRIMARY KEY | 自增主键 |
| q_type | TEXT | 题目类型 |
| difficulty | TEXT | 难度等级 |
| content | TEXT | 题目内容 |
| answer | TEXT | 参考答案 |

### 3. interview_record（面试记录表）
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER PRIMARY KEY | 自增主键 |
| interviewee_id | INTEGER | 面试者 ID（外键） |
| question_id | INTEGER | 题目 ID（外键） |
| score | INTEGER | 评分（0-10） |
| answer_snapshot | TEXT | 答题快照 JSON |
| month | TEXT | 月份（YYYY-MM） |
| created_at | TEXT | 创建时间 |

## 操作流程

### 第一步：导入题库

1. 点击左侧「📥 题库导入」面板中的「从 CSV 导入题库」按钮
2. 选择题库文件（支持 .csv、.xlsx、.xls 格式）
3. 系统自动解析并导入题库

**题库文件格式要求**：

必须包含以下列：
- `type`: 题目类型（如：算法、数据结构、操作系统等）
- `difficulty`: 难度等级（如：简单、中等、困难）
- `content`: 题目内容
- `answer`: 参考答案

示例（CSV）：
```csv
type,difficulty,content,answer
算法,中等,请解释快速排序的基本原理,快速排序采用分治策略...
数据结构,简单,什么是栈？请说明其特点,栈是一种后进先出(LIFO)的数据结构...
```

### 第二步：创建面试者

1. 在左侧「面试者信息」面板中填写：
   - 姓名（必填）
   - 邮箱（选填）
   - 电话（选填）
2. 点击「创建面试者」按钮
3. 系统自动生成面试者 ID 并启用后续功能

### 第三步：选择题库

1. 在右侧「题库选择」面板中：
   - 选择题目类型（下拉菜单）
   - 选择难度等级（下拉菜单）
2. 点击「加载题池」按钮
3. 系统显示题池加载状态和题目数量

**注意事项**：
- 切换题型/难度前，请先点击「下一题」保存当前题目
- 如不作答可直接跳过（系统会提示确认）

### 第四步：开始面试

1. 在「抽题区」点击「下一题」按钮
2. 系统随机显示一道题目，包含：
   - 题目类型和难度标签
   - 题目内容
   - 评分输入框（0-10 分）
   - 备注输入框（评分说明）
   - 参考答案（只读显示）
3. 根据面试者回答情况进行评分和备注
4. 点击「下一题」自动保存当前题目并显示下一题

### 第五步：结束面试

1. 完成所有题目后，在「面试记录」面板点击「结束面试并保存」
2. 系统将所有记录批量写入数据库
3. 面试结束

## 核心机制说明

### 1. 会话状态管理

系统通过 `InterviewSessionController` 管理面试流程状态：

- **INIT**: 初始状态
- **INTERVIEWEE_CREATED**: 面试者已创建
- **POOL_LOADED**: 题池已加载
- **QUESTION_ACTIVE**: 题目激活中
- **FINISHED**: 面试结束

状态转换确保操作顺序正确，防止数据不一致。

### 2. 随机抽题机制

- 使用确定性随机种子（基于题型+难度的 SHA256 哈希）
- 同一题池每次抽题顺序一致，保证可复现性
- 题目抽取后从池中移除，避免重复

### 3. 自动保存机制

- 点击「下一题」时自动保存当前题目结果
- 切换题池前提示保存或放弃当前题目
- 结束面试时批量提交所有记录（提高性能）

### 4. 数据隐私保护

- 面试者信息通过 SHA256 + SALT 生成哈希值
- 原始信息以 JSON 格式存储，支持后续扩展
- 哈希值用于去重和数据完整性校验

## 操作规范

### 必须遵守的规范

1. **严格按流程操作**：导入题库 → 创建面试者 → 加载题池 → 抽题面试 → 结束保存
2. **及时保存记录**：切换题池或结束面试前务必保存当前题目
3. **题库格式规范**：导入文件必须包含所有必需列
4. **单次面试原则**：一次面试对应一个面试者，不支持中途切换

### 建议的最佳实践

1. **题库准备**：提前准备好格式规范的题库文件
2. **面试计划**：预先确定每场面试的题型和难度组合
3. **备注详细**：在备注栏记录面试者的具体表现和亮点
4. **定期备份**：定期备份 `interview.db` 数据库文件
5. **导出分析**：使用 SQLite 工具导出数据进行统计分析

## 日后改动方向

### 短期优化（1-3 个月）

#### 1. 功能增强
- [ ] **题目编辑功能**：支持在界面上直接编辑、删除题库中的题目
- [ ] **批量导出**：导出面试记录为 Excel/PDF 报告
- [ ] **搜索功能**：按姓名、日期、题型搜索历史面试记录
- [ ] **数据可视化**：面试得分分布图、题型覆盖率统计

#### 2. 用户体验
- [ ] **快捷键支持**：常用操作绑定快捷键（如 Ctrl+N 下一题）
- [ ] **暗色主题**：支持切换界面主题
- [ ] **题目预览**：加载题池后显示题目列表概览
- [ ] **计时器**：为每道题目添加可选的答题计时功能

#### 3. 稳定性
- [ ] **异常处理**：完善文件导入、数据库操作的错误提示
- [ ] **数据校验**：增强输入数据的合法性检查
- [ ] **日志系统**：记录操作日志便于问题排查
- [ ] **自动备份**：每日自动备份数据库到指定目录

### 中期规划（3-6 个月）

#### 1. 架构优化
- [ ] **模块解耦**：将 UI 和业务逻辑进一步分离
- [ ] **配置文件**：支持外部配置文件（题型、难度、评分标准等）
- [ ] **插件系统**：支持自定义题目类型和评分规则
- [ ] **数据库迁移**：添加版本管理和自动升级机制

#### 2. 多人协作
- [ ] **面试官账户**：多面试官登录，记录操作人
- [ ] **权限管理**：管理员、面试官、查看者三级权限
- [ ] **并发访问**：支持多人同时使用（需改进数据库锁机制）

#### 3. 数据分析
- [ ] **统计报表**：月度/季度面试数据统计
- [ ] **趋势分析**：面试者整体水平变化趋势
- [ ] **题目分析**：识别难度不合理的题目
- [ ] **面试官一致性**：分析不同面试官评分差异

### 长期展望（6-12 个月）

#### 1. 智能化
- [ ] **AI 辅助评分**：集成 LLM 对开放性问题提供评分建议
- [ ] **语音转文字**：实时记录面试对话内容
- [ ] **题目推荐**：根据面试者表现智能推荐后续题目
- [ ] **知识图谱**：构建题目知识点关联网络

#### 2. 云端化
- [ ] **云端部署**：Web 版本，支持远程访问
- [ ] **数据同步**：本地与云端数据双向同步
- [ ] **移动端**：开发 iOS/Android 应用
- [ ] **视频面试**：集成视频会议功能

#### 3. 生态建设
- [ ] **题库市场**：共享和下载其他实验室的题库
- [ ] **API 接口**：开放 API 供其他系统集成
- [ ] **插件商店**：第三方开发者贡献功能插件
- [ ] **社区版/商业版**：开源社区版，提供付费增值服务

## 技术债务与已知问题

### 当前存在的问题

1. **单线程阻塞**：文件导入大题库时 UI 会卡顿
2. **内存管理**：长时间使用后可能出现内存泄漏
3. **跨平台兼容**：仅在 Windows 测试，Linux/Mac 兼容性未验证
4. **数据库并发**：WAL 模式下仍可能出现锁冲突
5. **Unicode 支持**：某些特殊字符可能导致显示异常

### 技术债务清单

1. **缺少单元测试**：关键业务逻辑无测试覆盖
2. **硬编码配置**：评分范围、字段名等应抽取为配置
3. **错误处理不完整**：部分异常未捕获或处理不当
4. **文档不足**：代码注释较少，缺少 API 文档
5. **日志缺失**：调试困难，问题难以追溯

## 开发环境配置

### 安装依赖

```bash
pip install PySide6 openpyxl
```

### 运行程序

```bash
python main.py
```

### 打包为可执行文件

```bash
pip install pyinstaller
pyinstaller main.spec
```

生成的可执行文件位于 `dist/` 目录。

## 贡献指南

欢迎提交 Issue 和 Fork！

## 许可证

[待补充]

## 联系方式

如有问题或建议，请issue。

---

**最后更新**: 2026-02-23
